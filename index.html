<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Social Dogs</title>

    <link rel="icon" href="src/paw-logo.png">

    <!-- Referencia a Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <!-- Referencia a jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>

<body onload="crearCarta()" style="background-color: #272c30;">
    <main>
        <div class="container">
            <div class="row mt-4 justify-content-center" style="background-color: red;">
                <div id="posts" class="col" style="background-color: blue">
                </div>



                <!-- <div id="referencia" class="col">
                <div class="card text-bg-dark mb-3 rounded-4 shadow-lg border-0" style="width: 40rem;">
                    <div class="card-body px-4 pt-4 pb-1">
                        <div class="px-2 pb-4">
                            <div class="d-flex gap-3 pb-2">
                                <div>
                                    <img src="src/Rick.jpeg" class="rounded-circle shadow-lg ratio ratio-1x1"
                                        Style="width: 3rem;" alt="Perfil">
                                </div>
                                <div class="d-flex my-auto">
                                    <h5 class="card-title fw-bold fs-4 text-capitalize">Rick Sanchez · Malamute</h5>
                                </div>
                            </div>
                            <p class="card-text fw-semibold fs-5">No hay nada como la vista de Luna corriendo y jugando
                                en
                                el
                                campo. Me encanta cómo su pelaje se mezcla con la hierba y las plantas, ¡parece una
                                verdadera reina de la naturaleza!</p>
                        </div>

                        <div>
                            <div class="ratio ratio-16x9">
                                <img src="src/perro.jpg" class="card-img-bottom rounded-4 object-fit-cover shadow-lg"
                                    alt="Alaskan Malamute">
                            </div>
                        </div>
                        <div class="px-2 py-1">
                            <span class="card-title fw-lighter fs-6 text-capitalize">Santiago, Chile · 18°</span>
                        </div>
                    </div>
                </div>
            </div> -->


            </div>
        </div>
    </main>



    <script>

        function printDatosPost() {
            console.log(generarPost());
        }

        // CAMBIAR EL NOMBRE POR ALGO MAS DESCRIPTIVO
        // Esta Funcion crea y retorna un objeto con toda la informacion necesaria para un post
        async function generarPost() {

            // Se crea un objeto "vacio" para evitar problemas con 'return'
            var datos_post = {
                nombre: 'Nombre',
                apellido: 'Apellido',
                raza_perro: '',
                img_perfil: '',
                ciudad: 'Ciudad',
                pais: 'País',
                temperatura: '-',
                img_perro: ''
            };



            // (nombre, apellido, img_perfil, ciudad, pais)
            // 1) La primera API en ser consultada nos da la información del usuario falso.
            await obtenerDatosRandomUserAPI().done(function (response) {
                datos_post['nombre'] = response.results[0].name.first;
                datos_post['apellido'] = response.results[0].name.last;

                datos_post['img_perfil'] = response.results[0].picture.thumbnail;


                datos_post['ciudad'] = response.results[0].location.city;
                datos_post['pais'] = response.results[0].location.country;

                console.log("Random Userr API:")
                console.log(datos_post)
                console.log(" ")
            }).fail(function (error) {
                console.log('Error Random User API:', error);
            });


            // (temperatura)
            // 2) Es importante la API del clima sea consultada despues de Random User, se necesita una ciudad para poder consultar la temperatura
            await obtenerDatosWeahterAPI(datos_post['ciudad']).done(function (response) {
                datos_post['temperatura'] = response.current.temp_c + "°";

                console.log("Weather API:");
                console.log(datos_post)
                console.log(" ")
            }).fail(function (error) {
                console.log('Error Weather API:', error);
                datos_post['temperatura'] = '-';
            });


            // (temperatura)
            // 3) Por ultimo buscamos una foto de un perro, esta API podria ser llamada en cualquier punto, pero decidi dejarla para el final
            // Aqui ademas extraeremos la raza del perro desde la URL que nos entrega la API, es más facil hacerlo asi
            await obtenerDatosDogAPI().done(function (response) {
                // Extrae la raza del perro de la URL
                const url = response.message;
                const regex = /breeds\/(.+?)\//;
                const match = url.match(regex);
                const raza = match[1];


                datos_post['img_perro'] = response.message;
                datos_post['raza_perro'] = raza;


                console.log("Dog API:");
                console.log(datos_post);
            }).fail(function (error) {
                console.log('Error Dog API:', error);
            });



            return datos_post;
        }




        // Gracias ChatGPT
        // No entiendo como funcionan pero estas funciones son las que realmente hacen la llamada a las APIs
        function obtenerDatosRandomUserAPI() {
            return $.ajax({
                url: 'https://randomuser.me/api/1.3/?nat=gb,us,au,ca&noinfo',
                method: 'GET',
                dataType: 'json'
            });
        }
        function obtenerDatosDogAPI() {
            return $.ajax({
                url: 'https://dog.ceo/api/breeds/image/random',
                method: 'GET',
                dataType: 'json'
            });
        }
        function obtenerDatosWeahterAPI(ciudad) {
            return $.ajax({
                url: 'https://api.weatherapi.com/v1/current.json?key=dcf3e5f1708e48f18e472023230605&q=' + ciudad,
                method: 'GET',
                dataType: 'json'
            });
        }




        async function crearCarta() {
            datos_post = await generarPost();

            var carta = "";
            carta += '<div  class="card text-bg-dark rounded-4 shadow-lg border-0 mx-auto mb-5" style="width: 70%;">'
            carta += '<div class="card-body px-4 pt-4 pb-1">'
            carta += '<div class="px-2 pb-4">'
            carta += '<div class="d-flex gap-3 pb-2">'
            carta += '<div>'
            carta += '<img src="' + datos_post['img_perfil'] + '" class="rounded-circle shadow-lg ratio ratio-1x1"'
            carta += 'Style="width: 3rem;" alt="Perfil">'
            carta += '</div>'
            carta += '<div class="d-flex my-auto">'
            carta += '<h5 class="card-title fw-bold fs-4 text-capitalize">' + datos_post['nombre'] + " " + datos_post['apellido'] + ' · ' + datos_post['raza_perro'] + '</h5>'
            carta += '</div>'
            carta += '</div>'
            // carta += '<p class="card-text fw-semibold fs-5">No hay nada como la vista de Luna corriendo y jugando en el '
            // carta += 'campo. Me encanta cómo su pelaje se mezcla con la hierba y las plantas, ¡parece una'
            // carta += 'verdadera reina de la naturaleza!</p>'
            carta += '</div>'
            carta += '<div>'
            carta += '<div class="">'
            carta += '<img src="' + datos_post['img_perro'] + '" class="card-img-bottom rounded-4  object-fit-cover shadow-lg"'
            carta += 'alt="' + datos_post['raza_perro'] + '">'
            carta += '</div>'
            carta += '</div>'
            carta += '<div class="px-2 py-1">'
            carta += '<span class="card-title fw-lighter fs-6 text-capitalize">' + datos_post['ciudad'] + ", " + datos_post['pais'] + " | " + datos_post['temperatura'] + '</span>'
            carta += '</div>'
            carta += '</div>'
            carta += '</div>'
            $("#posts").append(carta);
        }


    </script>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
</body>

</html>